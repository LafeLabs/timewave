    <!doctype html>
    <html lang="en">
    <head>
       <meta charset="utf-8">
       <!--
    
    TRASH MAGIC!
    
       -->
       <!--Stop Google:-->
       <META NAME="robots" CONTENT="noindex,nofollow">
  
<link href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//wAA//8AAP//AAD/3wAAH6gAAO93AAD3fwAA9v8AAPb/AAD2/wAA9v8AAPr/AAD9/wAA//8AAP//AAD//wAA" rel="icon" type="image/x-icon">
  
      <script src="https://cdn.jsdelivr.net/npm/p5@1.7.0/lib/p5.js"></script>    
       <title>TIMEWAVE</title>    
    </head>
    <body>    
            
            <h2>
            <a href = "edit.html">EDIT THIS PAGE</a>
            </h2>
            

<table>
    <tr>
        <td>START TIME [SECONDS]:</td>
        <td>
            <input id = "starttimeinput">
        </td>
        <td>STOP TIME [SECONDS]:</td>
        <td>
            <input id = "stoptimeinput">
        </td>
        <td>
            DELTAX [PIXELS]
        </td>
        <TD>
            <INPUT id = "deltaxinput">
        </TD>
    </tr>
    <tr>
        <td>W0:</td>
        <td>
            <input id = "w0input">
        </td>
        <td>W1:</td>
        <td>
            <input id = "w1input">
        </td>
        <td>W UNITS:</td>
        <td>
            <input id = "wunitinput">
        </td>
    </tr>
    
    <tr>
        <td>
            TIMEWAVE: 
        </td>
        <TD>
            <INPUT ID = "timewaveinput">
        </TD>
    </tr>
    
</table>

<script>

//document.getElementById("actioninput").select();
    

function preload() {
  img = loadImage('dataplot.png');
}

currentjson = {};
textsize = 25;

var httpc3 = new XMLHttpRequest();
httpc3.onreadystatechange = function(){
    if (this.readyState == 4 && this.status == 200) {
        currentjson = JSON.parse(this.responseText);
        loadjsonvals();
    }
};
httpc3.open("GET", "fileloader.php?filename=currentjson.txt", true);
httpc3.send();


function loadjsonvals(){

    document.getElementById("starttimeinput").value = currentjson.starttime;
    document.getElementById("stoptimeinput").value = currentjson.stoptime;
    document.getElementById("deltaxinput").value = currentjson.deltax;
    document.getElementById("wunitinput").value = currentjson.wunit;
    document.getElementById("w0input").value = currentjson.w0;
    document.getElementById("w1input").value = currentjson.w1;

}
/*
currentjson.imagex = 0;
currentjson.imagey = 0;
currentjson.deltaxy = 100;
currentjson.zoom = 1;
currentjson.startx = 117;
currentjson.stopx = 417;
currentjson.y0 = 400;
currentjson.y1 = 200;
currentjson.y1value = 10;
currentjson.y0value = 0;
*/

timewave = [0];

function setup() {

  createCanvas(img.width, img.height);    
//  image(img, -50, 0, width, height, 0, 0, img.width, img.height, CONTAIN)
 // image(img, imagex, imagey,width*zoom,height*zoom);
///  image(img, 50, -150, squaresize, squaresize);
  //image(img, 25, 25, 50, 50, 25, 25, 50, 50);
    
}

//resizeCanvas(500, 500);

function draw(){
  background(155);
  image(img,0,0,width,height);
  strokeWeight(4);
  if(tstartmode){
      currentjson.startx = mouseX;
  }
  if(tstopmode){
      currentjson.stopx = mouseX;
  }
  if(y0mode){
      currentjson.y0 = mouseY;
  }
  if(y1mode){
      currentjson.y1 = mouseY;
  }
  stroke("red");
  fill("red")
  line(currentjson.startx,0,currentjson.startx,height);
  textSize(textsize);
  line(0,currentjson.y0,width,currentjson.y0);
  strokeWeight(1);
//textAlign(LEFT);
  text("START TIME",currentjson.startx + 0.25*textsize,height - textsize);
  text("W0",0.25*textsize,currentjson.y0 - 0.25*textsize);
  stroke("blue");
  fill("blue");
  strokeWeight(4);
  line(currentjson.stopx,0,currentjson.stopx,height);
  line(0,currentjson.y1,width,currentjson.y1);
  strokeWeight(1);
  text("STOP TIME",currentjson.stopx -6*textsize,height - textsize);
  text("W1",0.25*textsize,currentjson.y1 - 0.25*textsize);
  

//  strokeWeight(20);
  stroke("purple");
  for(index = 0;index < timewave.length - 1;index++){
    line(currentjson.startx + index,timewave[index],currentjson.startx + index + 1,timewave[index + 1]);
//    line(imagex + (startx + index)*zoom,300,imagex + (startx + index + 1)*zoom,300);
    
  }
  if(gomode){
    line(currentjson.startx + timewave.length - 1,timewave[timewave.length - 1],mouseX,mouseY);    
  }


//  frameRate(30);
//    image(img, 0, 0,width,height);
  //  line(0,0,100,100);
}

tstartmode = false;
tstopmode = false;
y0mode = false;
y1mode = false;
gomode = false;
function keyPressed() {


  if (key === 'a') {
    tstartmode = !tstartmode;
  }
  if (key === 's') {
    tstopmode = !tstopmode;
  }
  if (key === 'd') {
    y0mode = !y0mode;
  }
  if (key === 'f') {
    y1mode = !y1mode;
  }
  if (key === 'g') {
    gomode = !gomode;
  }
  

  if (keyCode === 040) {//space bar
     timewave.push(timewave[timewave.length-1]);
  }
  if (keyCode === BACKSPACE) {
    // Code to run.
    timewave.pop();
  }

  if (keyCode === ENTER) {
    // Code to run.
    
  }

  savejson();
  savetimewave();
}



timewave = [];
var httpc = new XMLHttpRequest();
httpc.onreadystatechange = function(){
    if (this.readyState == 4 && this.status == 200) {
        timewave = JSON.parse(this.responseText);
    }
};
httpc.open("GET", "fileloader.php?filename=timewave.txt", true);
httpc.send();

function savetimewave(){

    var url = "filesaver.php";        
    var httpc = new XMLHttpRequest();
    httpc.open("POST", url, true);
    httpc.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    httpc.send("data="+encodeURIComponent(JSON.stringify(timewave,null,"    "))+"&filename=timewave.txt");//send text to filesaver.php

}

function savejson(){

    var url = "filesaver.php";        
    var httpc2 = new XMLHttpRequest();
    httpc2.open("POST", url, true);
    httpc2.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    httpc2.send("data="+encodeURIComponent(JSON.stringify(currentjson,null,"    "))+"&filename=currentjson.txt");//send text to filesaver.php

}

</script>
<STYLE>
    H1{
        TEXT-ALIGN:CENTER;
    }
    a{
        color:blue;
    }
    main canvas{
        border:solid;
    }
</STYLE>

    </body>
    </html>
    
    
